<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/adminlayout}">


<th:block layout:fragment="css">
    <style>
        .form-control:focus {
            outline: none !important;
            border-color : #FD6F22;
            box-shadow: 0 0 10px #FD6F22;
        }

        h3 {
            padding-top: 10px;
        }

        h5 {
            padding-bottom: 10px;
        }

        .surround {
            display: flex;
            flex-direction: column;
            min-height: 60vh;
        }

        .tableBox {
            flex: 1;
            overflow: auto;
            max-height: calc(60vh - 400px);
            padding: 10px;
        }

        .cateListBox{
            flex: 1;
            overflow: auto;
            max-height: calc(60vh - 300px);
            padding: 10px;
        }

        .buttonBox {
            text-align: right;
            padding-top: 10px;
        }
    </style>
</th:block>
<th:block layout:fragment="script">
    <script>
        document.addEventListener("DOMContentLoaded", function() {

            var modifyButtons = document.querySelectorAll(".modify-button");
            var deleteButtons = document.querySelectorAll(".delete-button");

            // tabId
            var tabSelector = [
                "#user-tab-pane",
                "#post-tab-pane",
                "#faq-tab-pane",
                "#question-tab-pane"
            ]

            tabSelector.forEach(function(tabSelector){
                handleAddNewCategory(tabSelector);
            });


            // ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€
            function handleAddNewCategory(tabId){
                var addNewCategoryButton = document.querySelector(tabId + " .clickable-text");
                var newCateSaveButton = document.querySelector(tabId + " .newCate-save-button");
                var categoryTable = document.querySelector(tabId + " .tableBox table");
                var maxCategoryCount = 4;
                var currentCategoryCount = 0;

                addNewCategoryButton.addEventListener("click", function() {
                    newCateSaveButton.removeAttribute("hidden");

                    if (currentCategoryCount < maxCategoryCount) {
                        // ìƒˆë¡œìš´ <tr> ì—˜ë¦¬ë¨¼íŠ¸ ìƒì„±
                        var newRow = document.createElement("tr");

                        // <td> ì—˜ë¦¬ë¨¼íŠ¸ ìƒì„±
                        var td = document.createElement("td");
                        td.colSpan = "3";

                        // ìƒˆë¡œìš´ ì…ë ¥ í•„ë“œ ìƒì„±
                        var newCategoryInput = document.createElement("input");
                        newCategoryInput.type = "text";
                        newCategoryInput.className = "newCate form-control";
                        newCategoryInput.placeholder = "ì¹´í…Œê³ ë¦¬ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”";

                        // ì…ë ¥ í•„ë“œë¥¼ <td>ì— ì¶”ê°€
                        td.appendChild(newCategoryInput);

                        // <tr>ì— <td>ë¥¼ ì¶”ê°€
                        newRow.appendChild(td);

                        // <tr>ì„ í…Œì´ë¸”ì— ì¶”ê°€
                        categoryTable.appendChild(newRow);

                        // ì¹´í…Œê³ ë¦¬ ê°œìˆ˜ ì—…ë°ì´íŠ¸
                        currentCategoryCount++;
                    }else {
                        alert("í•œ ë²ˆì— ìµœëŒ€ 4ê°œê¹Œì§€ ì¶”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
                    }
                });

                //ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ì €ì¥
                newCateSaveButton.addEventListener("click", function() {
                    var cateInputs = document.querySelectorAll(tabId + " .newCate");
                    console.log("cateInputs:::::::"+cateInputs.length)
                    var newCategoryNames = [];
                    var categoryKind = addNewCategoryButton.id;
                    console.log("categoryKind::::::"+categoryKind);
                    cateInputs.forEach(function(input){
                        if(input.value != null && input.value != undefined && input.value != ""){
                            console.log("newCategoryNames::::::"+newCategoryNames.push(input.value));
                        }
                    });

                    //JSON
                    var data = {
                        categoryKind: categoryKind,
                        newCategoryNames: newCategoryNames
                    };

                    var jsonData = JSON.stringify(data);

                    //AJAXë¡œ ë°ì´í„° ì „ë‹¬
                    fetch("/admin/category", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json;charset=UTF-8"
                        },
                        body: jsonData
                    })
                    .then(response => response.json())
                    .then(data => {
                        if(data.statusCode === 200){
                            Swal.fire({
                                text: 'ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.',
                                icon: 'success',
                                confirmButtonText: 'í™•ì¸'
                            }).then(() => {
                                 window.location.reload();
                            })
                        }else if(data.statusCode === 401){
                            alert(JSON.stringify(data.body))
                        }else {
                            Swal.fire('ì²˜ë¦¬ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                        }
                    })

                })

            }//END handleAddNewCategory



        });
    </script>
</th:block>

<div layout:fragment="content" class="container my-3">
    <h3>ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</h3><br>
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="user-tab-paen" data-bs-toggle="tab" data-bs-target="#user-tab-pane" type="button" role="tab" aria-controls="user-tab-pane" aria-selected="true">íšŒì› ì‹ ê³ </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="post-tab" data-bs-toggle="tab" data-bs-target="#post-tab-pane" type="button" role="tab" aria-controls="post-tab-pane" aria-selected="false">ê²Œì‹œë¬¼ ì‹ ê³ </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="faq-tab" data-bs-toggle="tab" data-bs-target="#faq-tab-pane" type="button" role="tab" aria-controls="faq-tab-pane" aria-selected="false">ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="question-tab" data-bs-toggle="tab" data-bs-target="#question-tab-pane" type="button" role="tab" aria-controls="question-tab-pane" aria-selected="false">ë¬¸ì˜í•˜ê¸°</button>
        </li>
    </ul>
    <br>
    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="user-tab-pane" role="tabpanel" aria-labelledby="user-tab" tabindex="0">
            <div class="container surround">
                <a href="#" class="clickable-text" id="user">+ìƒˆì¹´í…Œê³ ë¦¬ ì¶”ê°€</a>
                <div class="tableBox">
                    <table>

                    </table>
                </div>
                <div class="buttonBox">
                    <button type="button" class="newCate-save-button btn btn-primary" hidden="hidden">ì €ì¥</button>
                </div>
                <hr>
                <div class="cateListBox">
                    <h5>Â» ì¹´í…Œê³ ë¦¬ ëª©ë¡</h5>
                    <table>
                        <tr th:each="cateList : ${cateListU}">
                            <td><input type="text" class="KindName form-control" th:value="${cateList.userClaimKindName}" th:id="'user_' + ${cateList.userClaimKindSeq}" readonly></td>
                            <td><button type="button" class="modify-button btn btn-outline-warning" th:data-id="'user_' + ${cateList.userClaimKindSeq}">âœï¸ìˆ˜ì •ï¸</button></td>
                            <td><button type="button" class="delete-button btn btn-outline-danger" th:data-id="'user_' + ${cateList.userClaimKindSeq}">ğŸ—‘ï¸ì‚­ì œ</button></td>
                        </tr>
                    </table>
                </div>
                <div class="buttonBox">
                    <button type="button" class="save-button btn btn-primary">ì €ì¥</button>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="post-tab-pane" role="tabpanel" aria-labelledby="post-tab" tabindex="0">
            <div class="container surround">
                <a href="#" class="clickable-text" id="post">+ìƒˆì¹´í…Œê³ ë¦¬ ì¶”ê°€</a>
                <div class="tableBox">
                    <table>

                    </table>
                </div>
                <div class="buttonBox">
                    <button type="button" class="newCate-save-button btn btn-primary">ì €ì¥</button>
                </div>
                <hr>
                <div class="cateListBox">
                    <h5>Â» ì¹´í…Œê³ ë¦¬ ëª©ë¡</h5>
                    <table>
                        <tr th:each="cateList : ${cateListP}">
                            <td><input type="text" class="KindName form-control" th:value="${cateList.postClaimKindName}" th:id="'post_' + ${cateList.postClaimKindSeq}" readonly></td>
                            <td><button type="button" class="modify-button btn btn-outline-warning" th:data-id="'post_' + ${cateList.postClaimKindSeq}">âœï¸ìˆ˜ì •ï¸</button></td>
                            <td><button type="button" class="delete-button btn btn-outline-danger" th:data-id="'post_' + ${cateList.postClaimKindSeq}">ğŸ—‘ï¸ì‚­ì œ</button></td>
                        </tr>
                    </table>
                </div>
                <div class="buttonBox">
                    <button type="button" class="save-button btn btn-primary">ì €ì¥</button>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="faq-tab-pane" role="tabpanel" aria-labelledby="faq-tab" tabindex="0">
            <div class="container surround">
                <a href="#" class="clickable-text" id="faq">+ìƒˆì¹´í…Œê³ ë¦¬ ì¶”ê°€</a>
                <div class="tableBox">
                    <table>

                    </table>
                </div>
                <div class="buttonBox">
                    <button type="button" class="newCate-save-button btn btn-primary">ì €ì¥</button>
                </div>
                <hr>
                <div class="cateListBox">
                    <h5>Â» ì¹´í…Œê³ ë¦¬ ëª©ë¡</h5>
                    <table>
                        <tr th:each="cateList : ${cateListF}">
                            <td><input type="text" class="KindName form-control" th:value="${cateList.faqKindName}" th:id="'faq_' + ${cateList.faqKindSeq}" readonly></td>
                            <td><button type="button" class="modify-button btn btn-outline-warning" th:data-id="'faq_' + ${cateList.faqKindSeq}">âœï¸ìˆ˜ì •ï¸</button></td>
                            <td><button type="button" class="delete-button btn btn-outline-danger" th:data-id="'faq_' + ${cateList.faqKindSeq}">ğŸ—‘ï¸ì‚­ì œ</button></td>
                        </tr>
                    </table>
                </div>
                <div class="buttonBox">
                    <button type="button" class="save-button btn btn-primary">ì €ì¥</button>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="question-tab-pane" role="tabpanel" aria-labelledby="question-tab" tabindex="0">
            <div class="container surround">
                <a href="#" class="clickable-text" id="ques">+ìƒˆì¹´í…Œê³ ë¦¬ ì¶”ê°€</a>
                <div class="tableBox">
                    <table>

                    </table>
                </div>
                <div class="buttonBox">
                    <button type="button" class="newCate-save-button btn btn-primary">ì €ì¥</button>
                </div>
                <hr>
                <div class="cateListBox">
                    <h5>Â» ì¹´í…Œê³ ë¦¬ ëª©ë¡</h5>
                    <table>
                        <tr th:each="cateList : ${cateListQ}">
                            <td><input type="text" class="KindName form-control" th:value="${cateList.questionKindName}" th:id="'ques_' + ${cateList.questionKindSeq}" readonly></td>
                            <td><button type="button" class="modify-button btn btn-outline-warning" th:data-id="'ques_' + ${cateList.questionKindSeq}">âœï¸ìˆ˜ì •ï¸</button></td>
                            <td><button type="button" class="delete-button btn btn-outline-danger" th:data-id="'ques_' + ${cateList.questionKindSeq}">ğŸ—‘ï¸ì‚­ì œ</button></td>
                        </tr>
                    </table>
                </div>
                <div class="buttonBox">
                    <button type="button" class="save-button btn btn-primary">ì €ì¥</button>
                </div>
            </div>
        </div>
    </div>
</div>
</html>
